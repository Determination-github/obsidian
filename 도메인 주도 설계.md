6장

도메인 생명주기
객체의 두 가지 타입
- 사용된 후 가비지 컼ㄹ렉터에게 보내지는 단순하고 일시적인 객체
- 오래동안 지속되며, 다른 객체와 복잡한 상호의존성을 가지며 여러 가지 상태 변화를 겪기도 하는 객체

스팬딧은?
- 대게 두 번째 타입의 객체를 보유함

도메인 객체의 관리와 관련된 문제 2가지
1. 생명주기 동안의 무결성 유지
2. 생명주기 관리의 복잡성으로 모델이 난해해지는 것을 방지

cc
1. **생명주기 동안의 무결성 유지**: 이는 객체가 생성되고 제거될 때, 그리고 그 사이에 그 객체의 상태나 데이터가 일관되고 올바른지를 보장하는 것을 의미합니다. 즉, 객체가 생성되고 사용되는 동안에는 데이터나 상태가 변질되거나 잘못된 상태로 되지 않도록 보장해야 합니다. 예를 들어, 고객 객체의 경우 고객의 이름, 주소, 연락처 등의 데이터가 유효한지 확인하고, 그 유효성을 유지하는 것이 중요합니다.
    
2. **생명주기 관리의 복잡성으로 모델이 난해해지는 것을 방지**: 이는 객체의 생명주기(생성, 사용, 제거)를 관리하는 것이 복잡해질 때, 코드나 모델 자체가 이해하기 어려워지는 것을 말합니다. 객체의 생명주기가 복잡해지면 코드가 길어지고 복잡해질 수 있으며, 이는 유지보수와 확장에 어려움을 줄 수 있습니다. 이를 방지하기 위해서는 객체의 생명주기를 관리하는 코드를 명확하고 간결하게 유지하고, 객체 간의 관계나 행동을 명확하게 모델링하는 것이 중요합니다.

책에서 문제를 해결하는데 제안하는 3가지 패턴
- AGGREGATE(집합체)
- FACTORY(팩토리)
- REPOSITORY(리파지토리)


AGGREGATE
- 대부분의 업무 도메인은 상호 연관의 정도가 높다
- 객체 참조를 통해 얽히고 설킨 관계망을 추적해야 한다.

데이터베이스에서 Merchant 객체를 삭제한다면?
- 지출 객체는 삭제된 객체를 참조하게 됨
- 그러한 참조를 그대로 둔다면 데이터베이스에는 쓰레기 주소가 쌓인다.
- 가비지 컬렉션으로 쓰레기 주소를 삭제하더라도 기본적인 모델링 문제를 간과하고 해결하는 것
- 격리된 트랜잭션을 사용하더라도, 일반적인 객체 모델의 관계망은 잠재적 변경의 효과가 미칠 범위를 명확하게 한정해주지 않는다.
- 동일한 객체에 여러 클라이언트가 동시에 접근하는 시스템에서는 변경의 범위를 더욱 알맞게 한정해야 한다.

해결방법
- 다양한 트랜잭션 기술을 사용? x
- 모델에 경계를 명확하게 구분하고 도메인을 심층적으로 이해해야 함

캡슐화
- 객체지향 설계 원칙 중 하나
- 객체의 내부 상태와 동작을 외부에서 직접 접근하는 것을 제한
- 대신 객체의 퍼블릭 인터페이스를 통해서만 상호작용 할 수 있게 함

AGGREGATE
- 연관된 객체들의 집합을 의미
- 루트(Root)와 경계(Boundary)로 구분
- AGGREGATE에 무엇이 포함되고 포함되지 않는지를 정의해야 한다.
- 루트는 단 하나만 존재하고 AGGREGATE에 포함된 특정 엔티티를 가리킨다.
- 경계 안의 객체는 서로 참조할 수 있지만, 경계 밖의 객체는 AGGREGATE의 객체 중 루트만 참조할 수 있다.
- 즉, AGGREGATE는 하나 이상의 객체로 구성되어 있으며, 이들 객체는 논리적으로 연관되어 있다는 것을 의미
- AGGREGATE 내부의 객체들은 '함께 수정되어야 한다'는 의미를 내포


AGGREGATE와 불변식
- 불변식은 데이터가 변경될 때마다 유지돼야 하는 일관성 규칙
- 여러 AGGREGATE에 걸쳐 존재하는 규칙이 있을 수도 있다.
- AGGREGATE 내의 객체들은 함께 변경되며, 이 변경은 불변식을 위반하면 안된다.


AGGREGATE를 구현하기 위해 모든 트랜잭션에 적용되는 규치
- 루트 엔티티는 전역 실병성을 지니며 궁극적으로 불변식을 검사할 책임이 있음
- 경계 안의 엔티티는 지역 식별성을 지니며, 이런 지역 식별성은 해당 AGGREGATE 안에서만 유효
- AGGREGATE의 경계 밖에서는 루트 엔티티를 제외한 AGGREGATE 내부의 구성요소를 참조할 수 없음
- 루트는 VO(Value Object)의 복사본을 다른 객체에 전달해 줄수 있으며, 복사본에서는 어떤 일이 일어나든 문제되지 않는다.
- 데이터베이스 질의를 이용하면 AGGREGATE의 루트만 직접적으로 획득 가능, 다른 객체는 모두 AGGREGATE를 탐색해서 발견해야 함
- AGGREGATE안의 객체는 다른 AGGREGATE의 루트만 참조 가능
- 삭제 연산은 AGGREGATE 경계 안의 모든 요소를 한 번에 제거해야 함
- AGGREGATE 경계 안의 어떤 객체를 변경해도 전체 AGGREGATE의 불변식은 모두 지켜져야 함


7장
