# 코틀린 인 액션 10장 '애노테이션과 리플렉션'
---

날짜: 2023-12-06
태그:
메모:

애노테이션 적용
- 적용하려는 대상 앞에 애노테이션을 붙이면 된다.
- 애노테이션은 `@`과 애노테이션 이름으로 이루어진다.

@Deprecated
- 코틀린에서는 `replaceWith` 파라미터를 통해 옛버전을 대신할 수 있는 패턴을 제시할 수 있다.
- Deprecated된 요소를 어떤 다른 요소로 대체할 것인지 명시하는데 사용
- 사용자는 그 패턴을 보고 지원이 종료될 API 기능을 더 쉽게 새 버전으로 포팅할 수 있다.
- 예시:
```kotlin
@Deprecated("This function is deprecated. Use newFunction() instead.", replaceWith = ReplaceWith("newFunction()"))
fun oldFunction() {
    // 구형 코드
}

fun newFunction() {
    // 새로운 코드
}
```

코틀린 애노테이션 문법
- 클래스를 애노테이션 인자로 지정할 때는 `@MyAnnotation(MyClass::class)`처럼 '::class'를 클래스 이름 뒤에 넣어야 한다.
- 다른 애노테이션을 인자로 지정할 때는 인자로 들어가는 애노테이션의 이름 앞에 '@'를 넣지 않아야 한다.
- 배열을 인자로 지정하려면 `@RequestMapping(path=arrayOf("/foo", "/bar"))`처럼 'arrayOf' 함수를 사용한다.
- 애노테이션 인자를 컴파일 시점에 알 수 있어야 하므로 임의의 프로퍼티를 인자로 지정할 수 없다. 프로퍼티를 애노테이션 인자로 사용하려면 그 앞에 `const` 변경자를 붙여야 한다.


애노테이션 대상
- 사용 지점 대상(use-site target) 선언으로 애노테이션을 붙일 요소를 정할 수 있다.
- 사용 지점 대상은 '@' 기호와 애노테이션 이름 사이에 분리된다.
- 예시:
```kotlin
@Target(AnnotationTarget.FUNCTION) annotation class MyAnnotation
```
- 사용 지점 대상을 지점할 때 지원하는 목록
	- property: 프로퍼티 전체
	- field: 프로퍼티에 의해 생성되는 backing field
	- get: 프로퍼티 게터
	- set: 프로퍼티 세터
	- receiver: 확장 함수나 프로퍼티의 수신 객체 파라미터
	- param: 생성자 파라미터
	- setparam: 세터 파라미터
	- delegate: 위임 프로퍼티의 위임 인스턴스를 담아둔 필드
	- file: 파일 안에 선언된 최상위 함수와 프로퍼티를 담아두는 클래스

애노테이션을 활용한 JSON 직렬화 제어
@JsonExclude
- Jackson 라이브러리
- 용도: 필드를 직렬화에서 제외할 때 사용
- 예시:
```kotlin
import com.fasterxml.jackson.annotation.JsonExclude

data class Person(
	val name: String,
	@JsonExclude val age: Int
)
```
- 직렬화에서 제외하려고 하는 필드에 유용

@JsonName
- Kotlinx.serialization 라이브러리
- 용도: 필드의 직렬화된 이름을 지정할 때 사용
- 예시:
```kotlin
data class Person(
	@JsonName("alias") val firstName: String,
)
```

@Serializable
- 직렬화하고자 하는 클래스에 붙이는 애노테이션
- 예시:
```kotlin
import kotlinx.serialization.Serializable

@Serializable
data class Person(val name: String, val age: Int)
```

@SerialName
- 필드의 이름을 직렬화된 JSON에서 다르게 지정하고자 할 때 사용
- 예시:
```kotlin
import kotlinx.serialization.SerialName
import kotlinx.serialization.Seralizable

@Serializable
data class Person(
	@SerialName("full_name") val name: String,
	val age: Int
)
```

@Transient
- 특정 필드를 직렬화에서 제외하고자 할 때 사용
- 예시:
```kotlin
import kotlinx.serialization.Serializable
import kotlinx.serialization.Transient

@Serializable
data class Person(
	val name: String,
	val age: Int,
	@Transient val temporaryData: String
)
```


애노테이션 선언
- 코틀린에서 애노테이션은 `annotation class` 키워드를 사용해 선언
- 예시
```kotlin
annotation class JsonName(val name: String)
```
- 여기서 JsonName은 애노테이션의 이름이 된다.
- 예를 들어, 애노테이션을 사용하는 경우:
```kotlin
@JsonName
class Myclass {
	//클래스 내용
}
```
- 코틀린 애노테이션 적용 문법은 일반 생성자 문법과 같다.
- 예시:
```kotlin
annotation class MyAnnotation(val value: String, val priority: Int)

@MyAnnotation(value = "Hello", priority = 1) 
class MyClass { 
	// 클래스 내용 
}
```


메타애노테이션
- 코틀린 애노테이션 클래스에도 애노테이션을 붙일 수 있다.
- 애노테이션 클래스에 적용할 수 있는 애노테이션을 메타애노테이션이라고 부른다.
- 자주 사용되는 메타애노테이션

1. @Target:
	- 애노테이션이 적용될 수 있는 대상을 지정
	- 예를 들어, `@Target(AnnotationTarget.CLASS, AnnotationTarget.FUCNTION)`은 해당 애노테이션이 클래스와 함수에만 적용됨을 나타냄
2. @Retention:
	- 애노테이션이 유지되는 기간을 지정
	- 예를 들어, `@Retention(AnnotationRetention.RUNTIME)`은 런타임에 애노테이션 정보를 유지
	- 기본적으로 @Retention 어노테이션은 'RUNTIME'으로 지정
1. @Repeatable:
	- 같은 요소에 여러 번 적용할 수 있도록 허용
	- 예를 들어, `@Repeatable`을 사용하면 여러 번 동일한 애노테이션을  사용할 수 있음
2. @MustBeDocumented:
	- 애노테이션에 대한 문서를 자동으로 생성하는 도구가 해당 애노테이션을 문서화해야 함을 나타냄


애노테이션 파라미터로 클래스 사용
- 코틀린에서 애노테이션의 파라미터 클래스를 사용하는 경우, 클래스 참조를 전달할 수 잇다.
- 이를 위해 `KClass` 타입을 사용하며, 클래스 참조를 얻기 위해 `::class`구문을 사용한다.
- 예시:
```kotlin
import kotlin.reflect.KClass

annotation class MyAnnotation(val targetClass: KClass<*>)
```
- 위 코드에서 MyAnnotation은 targetClass라는 이름의 파라미터를 가지며, 이 파라미터의 타입은 'KClass<\*>'이다.
- 코틀린에서 `KClass`는 클래스 참조를 나타내는 타입을 의미

애노테이션 파라미터로 제네릭 클래스 받기
- 코틀린에서 애노테이션 파라미터로 제네릭 클래스를 받으려면, 애노테이션 클래스의 파라미터로 타입을 선언하고, 사용할 때는 해당 타입을 명시적으로 전달해야 함
- 예시:
```kotlin
import kotlin.reflect.KClass

annotation class MyGenericAnnotation(val targetClass: KClass<out Any>)

@MyGenericAnnotation(targetClass = String::class)
class MyClass
```
- 위의 코드에서 `MyGenericAnnotation`은 `targetClass`라는 이름의 애노테이션 파라미터를 가지고 있다.
- 이 파라미터는 `KClass<out Any>` 타입으로, 제네릭 클래스를 받을 수 있다. 
- `out Any`는 모든 클래스 타입을 포함하는 상한 경계를 의미


출처:
연결문서
